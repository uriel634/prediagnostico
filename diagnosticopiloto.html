<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diagnóstico Empresarial | Vestra Consultoría</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;700&family=Open+Sans:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #2A5CAA;
            --primary-light: #4A7CC8;
            --primary-dark: #1A4A8A;
            --accent: #FF6B35;
            --accent-light: #FF8C5A;
            --accent-dark: #E05A2A;
            --text: #333333;
            --text-light: #6C757D;
            --border: #DEE2E6;
            --bg: #F8FAFC;
            --card-bg: #FFFFFF;
            --success: #28A745;
            --error: #DC3545;
            --transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.1);
            --shadow-sm: 0 2px 8px rgba(0,0,0,0.08);
            --shadow-md: 0 4px 12px rgba(0,0,0,0.12);
            --shadow-lg: 0 8px 24px rgba(0,0,0,0.16);
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --text: #F0F0F0;
                --text-light: #B0B0B0;
                --bg: #121212;
                --card-bg: #1E1E1E;
                --border: #3A3A3A;
            }
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Open Sans', sans-serif;
            color: var(--text);
            background-color: var(--bg);
            line-height: 1.6;
            padding: 0;
            margin: 0;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header Styles */
        .diagnostic-header {
            display: flex;
            align-items: center;
            padding: 20px;
            background-color: var(--card-bg);
            border-radius: var(--radius-md);
            margin-bottom: 30px;
            box-shadow: var(--shadow-sm);
            position: relative;
            overflow: hidden;
        }

        .diagnostic-header::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--accent));
        }

        .logo {
            height: 50px;
            margin-right: 20px;
        }

        .header-content {
            flex: 1;
        }

        .header-content h1 {
            font-family: 'Montserrat', sans-serif;
            font-size: 28px;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 5px;
        }

        .header-content .subtitle {
            color: var(--text-light);
            font-size: 16px;
            font-weight: 300;
        }

        /* Progress Bar */
        .progress-container {
            width: 100%;
            background-color: var(--border);
            border-radius: 100px;
            margin: 30px 0;
            height: 10px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            border-radius: 100px;
            background: linear-gradient(90deg, var(--primary), var(--accent));
            width: 0%;
            transition: width 0.6s cubic-bezier(0.65, 0, 0.35, 1);
        }

        /* Form Sections */
        .form-section {
            display: none;
            background-color: var(--card-bg);
            padding: 30px;
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-sm);
            margin-bottom: 30px;
            border-left: 4px solid var(--primary);
            transition: var(--transition);
        }

        .form-section:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }

        .form-section.active {
            display: block;
            animation: fadeIn 0.6s cubic-bezier(0.39, 0.575, 0.565, 1) both;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Section Header */
        .section-header {
            display: flex;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border);
        }

        .section-icon {
            width: 44px;
            height: 44px;
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 16px;
            font-size: 18px;
            box-shadow: var(--shadow-sm);
        }

        .section-title {
            font-family: 'Montserrat', sans-serif;
            font-size: 22px;
            font-weight: 600;
            color: var(--primary);
            flex: 1;
        }

        .section-complete {
            color: var(--success);
            font-size: 14px;
            display: flex;
            align-items: center;
            font-weight: 600;
        }

        .section-complete i {
            margin-right: 6px;
        }

        /* Questions */
        .question-container {
            margin-bottom: 30px;
            background-color: var(--card-bg);
            padding: 20px;
            border-radius: var(--radius-sm);
            transition: var(--transition);
        }

        .question-container:hover {
            box-shadow: var(--shadow-sm);
        }

        .question-text {
            font-weight: 600;
            margin-bottom: 18px;
            font-size: 16px;
            line-height: 1.5;
        }

        .scale-container {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
            flex-wrap: wrap;
            gap: 8px;
        }

        .scale-option {
            text-align: center;
            flex: 1;
            min-width: 60px;
        }

        .scale-number {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background-color: var(--card-bg);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 8px;
            cursor: pointer;
            transition: var(--transition);
            border: 2px solid var(--border);
            font-weight: 600;
            position: relative;
        }

        .scale-number::before {
            content: '';
            position: absolute;
            top: -4px;
            left: -4px;
            right: -4px;
            bottom: -4px;
            border-radius: 50%;
            border: 2px solid transparent;
            transition: var(--transition);
        }

        .scale-number:hover, .scale-number:focus {
            border-color: var(--primary);
            outline: none;
        }

        .scale-number:hover::before {
            border-color: var(--primary-light);
        }

        .scale-number.selected {
            background-color: var(--primary);
            color: white;
            border-color: var(--primary);
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(42, 92, 170, 0.3);
        }

        .scale-number.selected::before {
            border-color: var(--primary-light);
        }

        .scale-label {
            font-size: 12px;
            color: var(--text-light);
            text-align: center;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1.3;
        }

        /* Navigation Buttons */
        .nav-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 40px;
            gap: 15px;
        }

        .btn {
            padding: 14px 28px;
            border-radius: var(--radius-sm);
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            font-size: 16px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn i {
            font-size: 14px;
        }

        .btn-primary {
            background-color: var(--primary);
            color: white;
            box-shadow: var(--shadow-sm);
        }

        .btn-primary:hover, .btn-primary:focus {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
            outline: none;
        }

        .btn-primary:active {
            transform: translateY(0);
        }

        .btn-primary:disabled {
            background-color: #A0A0A0;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
        }

        .btn-secondary {
            background-color: var(--card-bg);
            color: var(--primary);
            border: 1px solid var(--primary);
        }

        .btn-secondary:hover, .btn-secondary:focus {
            background-color: rgba(42, 92, 170, 0.1);
            transform: translateY(-2px);
            box-shadow: var(--shadow-sm);
            outline: none;
        }

        .btn-accent {
            background-color: var(--accent);
            color: white;
            box-shadow: var(--shadow-sm);
        }

        .btn-accent:hover, .btn-accent:focus {
            background-color: var(--accent-dark);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
            outline: none;
        }

        /* Results Section */
        .results-container {
            display: none;
            background-color: var(--card-bg);
            padding: 30px;
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-sm);
            animation: fadeIn 0.6s cubic-bezier(0.39, 0.575, 0.565, 1) both;
        }

        .results-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .results-header h2 {
            font-family: 'Montserrat', sans-serif;
            color: var(--primary);
            margin-bottom: 10px;
        }

        .results-header p {
            color: var(--text-light);
            max-width: 700px;
            margin: 0 auto;
        }

        /* Business Profile */
        .business-profile {
            background: linear-gradient(135deg, rgba(42, 92, 170, 0.1), rgba(255, 107, 53, 0.1));
            padding: 25px;
            border-radius: var(--radius-md);
            margin-bottom: 40px;
            text-align: center;
            border-left: 5px solid var(--accent);
            position: relative;
            overflow: hidden;
        }

        .business-profile::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100" fill="none" stroke="%232A5CAA" stroke-width="0.5" opacity="0.1"><path d="M0 0 L100 100 M100 0 L0 100"/></svg>');
            opacity: 0.1;
        }

        .profile-title {
            font-family: 'Montserrat', sans-serif;
            font-size: 24px;
            font-weight: 700;
            color: var(--accent);
            margin-bottom: 10px;
            position: relative;
        }

        .profile-description {
            font-size: 16px;
            line-height: 1.6;
            position: relative;
        }

        /* Radar Chart */
        .chart-container {
            position: relative;
            height: 400px;
            margin: 40px auto;
            max-width: 600px;
            background-color: var(--card-bg);
            padding: 20px;
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-sm);
        }

        .chart-legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            font-size: 14px;
        }

        .color-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        /* Results Table */
        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 40px;
            background-color: var(--card-bg);
            border-radius: var(--radius-md);
            overflow: hidden;
            box-shadow: var(--shadow-sm);
        }

        .results-table th {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            padding: 16px;
            text-align: left;
            font-weight: 600;
        }

        .results-table td {
            padding: 14px 16px;
            border-bottom: 1px solid var(--border);
        }

        .results-table tr:nth-child(even) {
            background-color: rgba(42, 92, 170, 0.05);
        }

        .results-table tr:last-child td {
            border-bottom: none;
        }

        .score-bar {
            height: 10px;
            background-color: var(--border);
            border-radius: 100px;
            margin-top: 8px;
            overflow: hidden;
        }

        .score-fill {
            height: 100%;
            border-radius: 100px;
            background: linear-gradient(90deg, var(--primary), var(--accent));
        }

        /* Recommendations */
        .recommendations {
            margin-top: 40px;
        }

        .recommendation-block {
            margin-bottom: 30px;
            background-color: var(--card-bg);
            padding: 20px;
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-sm);
            border-left: 4px solid var(--accent);
        }

        .recommendation-title {
            font-family: 'Montserrat', sans-serif;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            font-size: 18px;
        }

        .recommendation-title i {
            margin-right: 12px;
            color: var(--accent);
            font-size: 20px;
        }

        .recommendation-list {
            list-style-type: none;
        }

        .recommendation-list li {
            padding: 10px 0;
            border-bottom: 1px dashed var(--border);
            display: flex;
            align-items: flex-start;
            line-height: 1.5;
        }

        .recommendation-list li:before {
            content: "•";
            color: var(--accent);
            font-weight: bold;
            display: inline-block;
            width: 24px;
            font-size: 20px;
            line-height: 1;
        }

        /* Results Actions */
        .results-actions {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 40px;
            flex-wrap: wrap;
        }

        /* Spinner */
        .spinner {
            display: none;
            text-align: center;
            margin: 30px 0;
        }

        .spinner i {
            font-size: 28px;
            color: var(--primary);
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsive Adjustments */
        @media (max-width: 992px) {
            .container {
                padding: 15px;
            }
            
            .diagnostic-header {
                flex-direction: column;
                text-align: center;
                padding: 25px 20px;
            }
            
            .logo {
                margin-right: 0;
                margin-bottom: 15px;
                height: 60px;
            }
            
            .chart-container {
                height: 350px;
            }
        }

        @media (max-width: 768px) {
            .scale-container {
                gap: 6px;
            }
            
            .scale-option {
                min-width: 50px;
            }
            
            .scale-number {
                width: 40px;
                height: 40px;
                font-size: 14px;
            }
            
            .scale-label {
                font-size: 11px;
                height: 40px;
            }
            
            .nav-buttons, .results-actions {
                flex-direction: column;
                gap: 12px;
            }
            
            .btn {
                width: 100%;
                padding: 12px 20px;
            }
            
            .chart-container {
                height: 300px;
                padding: 15px;
            }
            
            .results-table th, 
            .results-table td {
                padding: 12px;
                font-size: 14px;
            }
        }

        @media (max-width: 480px) {
            .form-section, 
            .results-container {
                padding: 20px;
            }
            
            .section-header {
                flex-wrap: wrap;
            }
            
            .section-complete {
                margin-left: 60px;
                margin-top: 10px;
                width: 100%;
            }
            
            .scale-option {
                min-width: calc(33% - 6px);
            }
            
            .chart-container {
                height: 250px;
            }
            
            .profile-title {
                font-size: 20px;
            }
            
            .profile-description {
                font-size: 15px;
            }
        }

        /* Accessibility */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border-width: 0;
        }

        [aria-hidden="true"] {
            display: none;
        }

        /* Print Styles */
        @media print {
            body {
                background-color: white;
                color: black;
                font-size: 12pt;
            }
            
            .container {
                max-width: 100%;
                padding: 0;
            }
            
            .diagnostic-header,
            .form-section,
            .results-container {
                box-shadow: none;
                border: none;
                page-break-inside: avoid;
            }
            
            .nav-buttons,
            .results-actions {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header with Logo -->
        <header class="diagnostic-header">
            <!-- Logo placeholder - replace with actual logo -->
            <div class="logo" style="color: var(--primary); font-family: 'Montserrat', sans-serif; font-size: 24px; font-weight: 700;">
                VESTRA
                <div style="font-size: 12px; font-weight: 400; color: var(--text-light);">Consultoría en negocios</div>
            </div>
            <div class="header-content">
                <h1>Diagnóstico Empresarial</h1>
                <p class="subtitle">Evalúa el nivel de madurez de tu negocio y recibe recomendaciones personalizadas</p>
            </div>
        </header>
        
        <!-- Progress Bar -->
        <div class="progress-container">
            <div class="progress-bar" id="progressBar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
        </div>
        
        <!-- Form Sections Container -->
        <div id="form-sections-container"></div>
        
        <!-- Results Section -->
        <div class="results-container" id="results-section">
            <div class="results-header">
                <h2>Resultados de tu Diagnóstico Empresarial</h2>
                <p>Basado en tus respuestas, aquí tienes un análisis completo de la madurez de tu negocio y recomendaciones estratégicas</p>
            </div>
            
            <div class="business-profile">
                <h3 class="profile-title" id="profile-title"></h3>
                <p class="profile-description" id="profile-description"></p>
            </div>
            
            <!-- Radar Chart -->
            <div class="chart-container">
                <canvas id="radarChart"></canvas>
                <div class="chart-legend">
                    <div class="legend-item"><span class="color-dot" style="background: var(--primary)"></span> Tu empresa</div>
                </div>
            </div>
            
            <!-- Results Table -->
            <table class="results-table">
                <thead>
                    <tr>
                        <th>Área</th>
                        <th>Puntuación</th>
                        <th>Nivel</th>
                    </tr>
                </thead>
                <tbody id="results-table-body">
                    <!-- Generated dynamically -->
                </tbody>
            </table>
            
            <!-- Recommendations -->
            <div class="recommendations" id="recommendations-container">
                <!-- Generated dynamically -->
            </div>
            
            <!-- PDF Generation Spinner -->
            <div class="spinner" id="pdf-spinner">
                <i class="fas fa-spinner"></i>
                <p>Generando tu reporte ejecutivo...</p>
            </div>
            
            <!-- Results Actions -->
            <div class="results-actions">
                <button class="btn btn-primary download-btn" id="downloadBtn">
                    <i class="fas fa-download"></i> Descargar Reporte (PDF)
                </button>
                <button class="btn btn-accent" id="restartBtn">
                    <i class="fas fa-redo"></i> Reiniciar Cuestionario
                </button>
                <a href="/" class="btn btn-secondary" id="homeBtn">
                    <i class="fas fa-home"></i> Volver al Inicio
                </a>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Configuration with all questions
            const config = {
                sections: [
                    {
                        id: 'finanzas',
                        title: 'Finanzas',
                        icon: 'fa-chart-line',
                        questions: [
                            {
                                text: '¿Con qué frecuencia analizas tus estados financieros (balance general, estado de resultados, flujo de efectivo)?',
                                options: [
                                    { value: 0, label: 'Nunca' },
                                    { value: 1, label: 'Anualmente' },
                                    { value: 2, label: 'Semestralmente' },
                                    { value: 3, label: 'Trimestralmente' },
                                    { value: 4, label: 'Mensualmente' },
                                    { value: 5, label: 'Semanalmente' }
                                ]
                            },
                            {
                                text: '¿Cómo manejas el presupuesto y la planeación financiera en tu empresa?',
                                options: [
                                    { value: 0, label: 'No tenemos presupuesto' },
                                    { value: 1, label: 'Presupuesto mental' },
                                    { value: 2, label: 'Presupuesto básico' },
                                    { value: 3, label: 'Presupuesto anual' },
                                    { value: 4, label: 'Presupuesto con revisiones' },
                                    { value: 5, label: 'Presupuesto detallado con KPIs' }
                                ]
                            },
                            {
                                text: '¿Qué tan claro tienes tus márgenes de utilidad por producto/servicio?',
                                options: [
                                    { value: 0, label: 'No los conozco' },
                                    { value: 1, label: 'Estimado general' },
                                    { value: 2, label: 'Conozco algunos' },
                                    { value: 3, label: 'Conozco la mayoría' },
                                    { value: 4, label: 'Conozco todos' },
                                    { value: 5, label: 'Con análisis detallado' }
                                ]
                            },
                            {
                                text: '¿Cómo es tu flujo de efectivo y capacidad para cubrir obligaciones?',
                                options: [
                                    { value: 0, label: 'Frecuentes problemas' },
                                    { value: 1, label: 'Justo cubro gastos' },
                                    { value: 2, label: 'Algo de margen' },
                                    { value: 3, label: 'Buen flujo' },
                                    { value: 4, label: 'Flujo saludable' },
                                    { value: 5, label: 'Excelente con reservas' }
                                ]
                            },
                            {
                                text: '¿Qué sistemas utilizas para el control financiero?',
                                options: [
                                    { value: 0, label: 'Ninguno' },
                                    { value: 1, label: 'Excel básico' },
                                    { value: 2, label: 'Software contable' },
                                    { value: 3, label: 'ERP básico' },
                                    { value: 4, label: 'ERP integrado' },
                                    { value: 5, label: 'Sistema avanzado con BI' }
                                ]
                            }
                        ]
                    },
                    {
                        id: 'ventas',
                        title: 'Ventas y Marketing',
                        icon: 'fa-shopping-cart',
                        questions: [
                            {
                                text: '¿Cómo defines tus estrategias de marketing y ventas?',
                                options: [
                                    { value: 0, label: 'No tengo estrategia' },
                                    { value: 1, label: 'Intuición' },
                                    { value: 2, label: 'Estrategia básica' },
                                    { value: 3, label: 'Estrategia documentada' },
                                    { value: 4, label: 'Estrategia con métricas' },
                                    { value: 5, label: 'Estrategia integrada' }
                                ]
                            },
                            {
                                text: '¿Qué tan claro tienes tu propuesta de valor y diferenciación?',
                                options: [
                                    { value: 0, label: 'No la tengo' },
                                    { value: 1, label: 'Idea básica' },
                                    { value: 2, label: 'Algo definida' },
                                    { value: 3, label: 'Definida' },
                                    { value: 4, label: 'Clara y comunicada' },
                                    { value: 5, label: 'Optimizada continuamente' }
                                ]
                            },
                            {
                                text: '¿Cómo es tu proceso de ventas?',
                                options: [
                                    { value: 0, label: 'No hay proceso' },
                                    { value: 1, label: 'Informal' },
                                    { value: 2, label: 'Algo estructurado' },
                                    { value: 3, label: 'Documentado' },
                                    { value: 4, label: 'Seguimiento métrico' },
                                    { value: 5, label: 'Optimizado continuamente' }
                                ]
                            },
                            {
                                text: '¿Qué sistemas usas para gestionar clientes y ventas?',
                                options: [
                                    { value: 0, label: 'Ninguno' },
                                    { value: 1, label: 'Excel/Notas' },
                                    { value: 2, label: 'CRM básico' },
                                    { value: 3, label: 'CRM profesional' },
                                    { value: 4, label: 'CRM integrado' },
                                    { value: 5, label: 'Sistema avanzado' }
                                ]
                            },
                            {
                                text: '¿Cómo es tu estrategia de fidelización de clientes?',
                                options: [
                                    { value: 0, label: 'No tengo' },
                                    { value: 1, label: 'Relación personal' },
                                    { value: 2, label: 'Programa básico' },
                                    { value: 3, label: 'Programa estructurado' },
                                    { value: 4, label: 'Programa con métricas' },
                                    { value: 5, label: 'Estrategia integral' }
                                ]
                            }
                        ]
                    },
                    {
                        id: 'operaciones',
                        title: 'Operaciones',
                        icon: 'fa-cogs',
                        questions: [
                            {
                                text: '¿Cómo están documentados tus procesos operativos?',
                                options: [
                                    { value: 0, label: 'Nada documentado' },
                                    { value: 1, label: 'Algunos en mi cabeza' },
                                    { value: 2, label: 'Algunos documentados' },
                                    { value: 3, label: 'La mayoría documentados' },
                                    { value: 4, label: 'Todos documentados' },
                                    { value: 5, label: 'Optimizados continuamente' }
                                ]
                            },
                            {
                                text: '¿Qué nivel de estandarización tienen tus operaciones?',
                                options: [
                                    { value: 0, label: 'Nada estandarizado' },
                                    { value: 1, label: 'Algo de consistencia' },
                                    { value: 2, label: 'Algunos estándares' },
                                    { value: 3, label: 'Buen nivel' },
                                    { value: 4, label: 'Altamente estandarizado' },
                                    { value: 5, label: 'Excelencia operativa' }
                                ]
                            },
                            {
                                text: '¿Cómo manejas la calidad de tus productos/servicios?',
                                options: [
                                    { value: 0, label: 'No hay control' },
                                    { value: 1, label: 'Revisión ocasional' },
                                    { value: 2, label: 'Algunos controles' },
                                    { value: 3, label: 'Procesos definidos' },
                                    { value: 4, label: 'Sistema de calidad' },
                                    { value: 5, label: 'Mejora continua' }
                                ]
                            },
                            {
                                text: '¿Qué sistemas usas para gestionar operaciones?',
                                options: [
                                    { value: 0, label: 'Ninguno' },
                                    { value: 1, label: 'Excel/Herramientas básicas' },
                                    { value: 2, label: 'Software específico' },
                                    { value: 3, label: 'Sistemas integrados' },
                                    { value: 4, label: 'ERP operativo' },
                                    { value: 5, label: 'Tecnología avanzada' }
                                ]
                            },
                            {
                                text: '¿Cómo es tu cadena de suministro y proveedores?',
                                options: [
                                    { value: 0, label: 'Improvisada' },
                                    { value: 1, label: 'Algunos proveedores' },
                                    { value: 2, label: 'Proveedores regulares' },
                                    { value: 3, label: 'Proveedores confiables' },
                                    { value: 4, label: 'Cadena optimizada' },
                                    { value: 5, label: 'Estrategia de suministro' }
                                ]
                            }
                        ]
                    },
                    {
                        id: 'personas',
                        title: 'Personas y Equipo',
                        icon: 'fa-users',
                        questions: [
                            {
                                text: '¿Cómo es tu proceso de reclutamiento y selección?',
                                options: [
                                    { value: 0, label: 'No hay proceso' },
                                    { value: 1, label: 'Contratación informal' },
                                    { value: 2, label: 'Algo estructurado' },
                                    { value: 3, label: 'Proceso definido' },
                                    { value: 4, label: 'Con evaluación técnica' },
                                    { value: 5, label: 'Sistema integral' }
                                ]
                            },
                            {
                                text: '¿Cómo capacitas y desarrollas a tu equipo?',
                                options: [
                                    { value: 0, label: 'No hay capacitación' },
                                    { value: 1, label: 'Ocasionalmente' },
                                    { value: 2, label: 'Capacitación básica' },
                                    { value: 3, label: 'Programa regular' },
                                    { value: 4, label: 'Desarrollo continuo' },
                                    { value: 5, label: 'Plan de carrera' }
                                ]
                            },
                            {
                                text: '¿Cómo evalúas el desempeño de tu equipo?',
                                options: [
                                    { value: 0, label: 'No evalúo' },
                                    { value: 1, label: 'Por intuición' },
                                    { value: 2, label: 'Revisión informal' },
                                    { value: 3, label: 'Evaluación anual' },
                                    { value: 4, label: 'Evaluación periódica' },
                                    { value: 5, label: 'Sistema integral' }
                                ]
                            },
                            {
                                text: '¿Cómo es la cultura y clima organizacional?',
                                options: [
                                    { value: 0, label: 'No hay cultura definida' },
                                    { value: 1, label: 'Basada en el dueño' },
                                    { value: 2, label: 'Algunos valores' },
                                    { value: 3, label: 'Cultura definida' },
                                    { value: 4, label: 'Cultura fortalecida' },
                                    { value: 5, label: 'Cultura de alto desempeño' }
                                ]
                            },
                            {
                                text: '¿Cómo manejas la compensación y beneficios?',
                                options: [
                                    { value: 0, label: 'No hay estructura' },
                                    { value: 1, label: 'Salarios básicos' },
                                    { value: 2, label: 'Algunos beneficios' },
                                    { value: 3, label: 'Estructura definida' },
                                    { value: 4, label: 'Paquete competitivo' },
                                    { value: 5, label: 'Sistema estratégico' }
                                ]
                            }
                        ]
                    },
                    {
                        id: 'estrategia',
                        title: 'Estrategia y Dirección',
                        icon: 'fa-chess',
                        questions: [
                            {
                                text: '¿Qué tan clara tienes tu visión y misión empresarial?',
                                options: [
                                    { value: 0, label: 'No las tengo' },
                                    { value: 1, label: 'Idea básica' },
                                    { value: 2, label: 'Algo definidas' },
                                    { value: 3, label: 'Documentadas' },
                                    { value: 4, label: 'Comunicadas al equipo' },
                                    { value: 5, label: 'Guían todas las decisiones' }
                                ]
                            },
                            {
                                text: '¿Cómo defines y haces seguimiento a tus objetivos?',
                                options: [
                                    { value: 0, label: 'No tengo objetivos' },
                                    { value: 1, label: 'Objetivos mentales' },
                                    { value: 2, label: 'Algunos escritos' },
                                    { value: 3, label: 'Objetivos anuales' },
                                    { value: 4, label: 'Con seguimiento' },
                                    { value: 5, label: 'Sistema estratégico' }
                                ]
                            },
                            {
                                text: '¿Cómo tomas decisiones estratégicas?',
                                options: [
                                    { value: 0, label: 'Intuición/improvisación' },
                                    { value: 1, label: 'Basada en experiencia' },
                                    { value: 2, label: 'Algo de análisis' },
                                    { value: 3, label: 'Proceso definido' },
                                    { value: 4, label: 'Con datos e indicadores' },
                                    { value: 5, label: 'Sistema estratégico' }
                                ]
                            },
                            {
                                text: '¿Qué tan preparado está tu negocio para crecer?',
                                options: [
                                    { value: 0, label: 'No puedo crecer' },
                                    { value: 1, label: 'Crecimiento limitado' },
                                    { value: 2, label: 'Alguna capacidad' },
                                    { value: 3, label: 'Preparado para crecer' },
                                    { value: 4, label: 'Estructura escalable' },
                                    { value: 5, label: 'Listo para expansión' }
                                ]
                            },
                            {
                                text: '¿Cómo manejas la innovación en tu empresa?',
                                options: [
                                    { value: 0, label: 'No hay innovación' },
                                    { value: 1, label: 'Ocasional' },
                                    { value: 2, label: 'Algunas mejoras' },
                                    { value: 3, label: 'Proceso de mejora' },
                                    { value: 4, label: 'Cultura innovadora' },
                                    { value: 5, label: 'Innovación estratégica' }
                                ]
                            }
                        ]
                    }
                ],
                recommendations: {
                    finanzas: {
                        '0-5': [
                            'Implementa un sistema básico de registro financiero (puede ser Excel o software simple)',
                            'Comienza a revisar tus números financieros al menos mensualmente',
                            'Separa tus finanzas personales de las del negocio'
                        ],
                        '6-10': [
                            'Establece un presupuesto formal para el próximo trimestre',
                            'Implementa un software contable básico',
                            'Analiza tus márgenes por producto/servicio al menos una vez al mes'
                        ],
                        '11-15': [
                            'Desarrolla un sistema de reportes financieros mensuales con KPIs clave',
                            'Considera implementar un ERP financiero integrado',
                            'Establece metas financieras trimestrales y haz seguimiento'
                        ],
                        '16-20': [
                            'Optimiza tu estructura de costos y flujo de efectivo',
                            'Implementa análisis financieros avanzados (puntos de equilibrio, escenarios)',
                            'Desarrolla un sistema de pronósticos financieros'
                        ],
                        '21-25': [
                            'Automatiza procesos financieros para mayor eficiencia',
                            'Implementa análisis predictivos para toma de decisiones',
                            'Explora estrategias avanzadas de gestión de capital y financiamiento'
                        ]
                    },
                    ventas: {
                        '0-5': [
                            'Define claramente tu propuesta de valor y diferenciación',
                            'Establece un proceso básico de ventas (pasos a seguir)',
                            'Implementa un sistema simple para registrar clientes y ventas'
                        ],
                        '6-10': [
                            'Documenta tu proceso de ventas actual y mejóralo',
                            'Implementa un CRM básico para gestionar clientes',
                            'Desarrolla una estrategia de marketing digital básica'
                        ],
                        '11-15': [
                            'Optimiza tu funnel de ventas con métricas clave',
                            'Implementa un CRM profesional con seguimiento de oportunidades',
                            'Desarrolla programas de fidelización de clientes'
                        ],
                        '16-20': [
                            'Automatiza partes de tu proceso de ventas y marketing',
                            'Implementa análisis avanzado de datos de clientes',
                            'Desarrolla estrategias de upselling y cross-selling'
                        ],
                        '21-25': [
                            'Implementa inteligencia artificial para personalización de ventas',
                            'Desarrolla programas avanzados de retención y lealtad',
                            'Integra completamente tus sistemas de ventas, marketing y servicio al cliente'
                        ]
                    },
                    operaciones: {
                        '0-5': [
                            'Documenta tus procesos operativos más importantes',
                            'Establece estándares básicos de calidad',
                            'Identifica y formaliza relaciones con proveedores clave'
                        ],
                        '6-10': [
                            'Estandariza tus procesos operativos principales',
                            'Implementa controles básicos de calidad',
                            'Considera software especializado para tus operaciones'
                        ],
                        '11-15': [
                            'Optimiza tus procesos operativos clave',
                            'Implementa un sistema de gestión de calidad',
                            'Automatiza procesos operativos repetitivos'
                        ],
                        '16-20': [
                            'Implementa metodologías de mejora continua (Lean, Six Sigma)',
                            'Desarrolla un sistema de gestión de la cadena de suministro',
                            'Integra tus sistemas operativos con otras áreas'
                        ],
                        '21-25': [
                            'Implementa tecnologías avanzadas (IoT, automatización)',
                            'Desarrolla capacidades de manufactura/escala clase mundial',
                            'Crea un sistema de innovación operativa continua'
                        ]
                    },
                    personas: {
                        '0-5': [
                            'Establece descripciones básicas de puesto',
                            'Implementa un proceso básico de contratación',
                            'Define una estructura salarial básica'
                        ],
                        '6-10': [
                            'Desarrolla un manual básico de políticas',
                            'Implementa un programa de inducción para nuevos empleados',
                            'Establece un sistema básico de evaluación de desempeño'
                        ],
                        '11-15': [
                            'Desarrolla programas de capacitación regulares',
                            'Implementa un sistema formal de evaluación de desempeño',
                            'Define y comunica claramente la cultura organizacional'
                        ],
                        '16-20': [
                            'Desarrolla planes de carrera y sucesión',
                            'Implementa programas de desarrollo de liderazgo',
                            'Optimiza tu paquete de compensación y beneficios'
                        ],
                        '21-25': [
                            'Implementa programas avanzados de desarrollo organizacional',
                            'Crea una cultura de alto desempeño y aprendizaje continuo',
                            'Desarrolla estrategias avanzadas de gestión del talento'
                        ]
                    },
                    estrategia: {
                        '0-5': [
                            'Define claramente tu visión y misión empresarial',
                            'Establece 3-5 objetivos clave para el próximo año',
                            'Implementa reuniones periódicas de revisión estratégica'
                        ],
                        '6-10': [
                            'Documenta tu plan estratégico básico',
                            'Establece métricas clave para medir progreso',
                            'Analiza regularmente tu entorno competitivo'
                        ],
                        '11-15': [
                            'Desarrolla un plan estratégico formal con iniciativas clave',
                            'Implementa un sistema de seguimiento de objetivos (OKRs/KPIs)',
                            'Establece un proceso formal de toma de decisiones estratégicas'
                        ],
                        '16-20': [
                            'Optimiza tu proceso de planeación estratégica',
                            'Desarrolla capacidades de análisis estratégico avanzado',
                            'Implementa sistemas de innovación estratégica'
                        ],
                        '21-25': [
                            'Desarrolla capacidades de anticipación estratégica',
                            'Implementa sistemas de gestión del cambio estratégico',
                            'Crea un proceso de reinvención estratégica continua'
                        ]
                    }
                }
            };

            // Application state
            const state = {
                currentSection: 0,
                answers: {},
                scores: {},
                totalScore: 0,
                radarChart: null
            };

            // Initialize the application
            init();

            function init() {
                // Initialize answer structure
                config.sections.forEach(section => {
                    state.answers[section.id] = Array(section.questions.length).fill(null);
                });
                
                loadProgress();
                renderFormSections();
                setupEventListeners();
                showSection(state.currentSection);
                updateProgressBar();
            }

            function renderFormSections() {
                const container = document.getElementById('form-sections-container');
                container.innerHTML = '';
                
                config.sections.forEach((section, sectionIndex) => {
                    const sectionEl = document.createElement('div');
                    sectionEl.className = 'form-section';
                    sectionEl.id = `section-${section.id}`;
                    
                    // Section header
                    const header = document.createElement('div');
                    header.className = 'section-header';
                    
                    const icon = document.createElement('div');
                    icon.className = 'section-icon';
                    icon.innerHTML = `<i class="fas ${section.icon}"></i>`;
                    icon.setAttribute('aria-hidden', 'true');
                    
                    const title = document.createElement('div');
                    title.className = 'section-title';
                    title.textContent = section.title;
                    
                    const completeIndicator = document.createElement('div');
                    completeIndicator.className = 'section-complete hidden';
                    completeIndicator.id = `${section.id}-complete`;
                    completeIndicator.innerHTML = '<i class="fas fa-check-circle"></i> Completo';
                    
                    header.appendChild(icon);
                    header.appendChild(title);
                    header.appendChild(completeIndicator);
                    sectionEl.appendChild(header);
                    
                    // Questions
                    section.questions.forEach((question, questionIndex) => {
                        const questionContainer = document.createElement('div');
                        questionContainer.className = 'question-container';
                        
                        const questionText = document.createElement('div');
                        questionText.className = 'question-text';
                        questionText.textContent = `${questionIndex + 1}. ${question.text}`;
                        questionContainer.appendChild(questionText);
                        
                        const scaleContainer = document.createElement('div');
                        scaleContainer.className = 'scale-container';
                        
                        question.options.forEach(option => {
                            const scaleOption = document.createElement('div');
                            scaleOption.className = 'scale-option';
                            
                            const scaleNumber = document.createElement('div');
                            scaleNumber.className = 'scale-number';
                            scaleNumber.textContent = option.value;
                            scaleNumber.setAttribute('data-value', option.value);
                            scaleNumber.setAttribute('data-section', section.id);
                            scaleNumber.setAttribute('data-question', questionIndex);
                            scaleNumber.setAttribute('tabindex', '0');
                            scaleNumber.setAttribute('role', 'button');
                            scaleNumber.setAttribute('aria-label', `Opción ${option.value}: ${option.label}`);
                            
                            // Mark as selected if already answered
                            if (state.answers[section.id][questionIndex] === option.value) {
                                scaleNumber.classList.add('selected');
                                scaleNumber.setAttribute('aria-pressed', 'true');
                            } else {
                                scaleNumber.setAttribute('aria-pressed', 'false');
                            }
                            
                            const scaleLabel = document.createElement('div');
                            scaleLabel.className = 'scale-label';
                            scaleLabel.textContent = option.label;
                            
                            scaleOption.appendChild(scaleNumber);
                            scaleOption.appendChild(scaleLabel);
                            scaleContainer.appendChild(scaleOption);
                        });
                        
                        questionContainer.appendChild(scaleContainer);
                        sectionEl.appendChild(questionContainer);
                    });
                    
                    // Navigation buttons
                    const navButtons = document.createElement('div');
                    navButtons.className = 'nav-buttons';
                    
                    const prevBtn = document.createElement('button');
                    prevBtn.className = 'btn btn-secondary';
                    prevBtn.id = 'prevBtn';
                    prevBtn.textContent = 'Anterior';
                    prevBtn.disabled = sectionIndex === 0;
                    
                    const nextBtn = document.createElement('button');
                    nextBtn.className = 'btn btn-primary';
                    nextBtn.id = 'nextBtn';
                    nextBtn.textContent = sectionIndex === config.sections.length - 1 ? 'Finalizar' : 'Siguiente';
                    nextBtn.disabled = !isSectionComplete(section.id);
                    
                    navButtons.appendChild(prevBtn);
                    navButtons.appendChild(nextBtn);
                    sectionEl.appendChild(navButtons);
                    
                    container.appendChild(sectionEl);
                });
            }

            function setupEventListeners() {
                // Scale option selection
                document.addEventListener('click', function(e) {
                    if (e.target.classList.contains('scale-number')) {
                        handleScaleSelection(e.target);
                    }
                });
                
                // Keyboard navigation for scale options
                document.addEventListener('keydown', function(e) {
                    if ((e.key === 'Enter' || e.key === ' ') && e.target.classList.contains('scale-number')) {
                        e.preventDefault();
                        handleScaleSelection(e.target);
                    }
                });
                
                // Main navigation
                document.addEventListener('click', function(e) {
                    if (e.target.id === 'prevBtn') prevSection();
                    if (e.target.id === 'nextBtn') nextSection();
                    if (e.target.id === 'downloadBtn') generatePDF();
                    if (e.target.id === 'restartBtn') restartQuestionnaire();
                    if (e.target.id === 'homeBtn') {
                        e.preventDefault();
                        window.location.href = '/';
                    }
                });
                
                // Keyboard navigation for buttons
                document.addEventListener('keydown', function(e) {
                    if (e.key === 'ArrowRight' && document.activeElement.id === 'nextBtn') {
                        nextSection();
                    } else if (e.key === 'ArrowLeft' && document.activeElement.id === 'prevBtn') {
                        prevSection();
                    }
                });
            }
            
            function handleScaleSelection(target) {
                const value = parseInt(target.getAttribute('data-value'));
                const section = target.getAttribute('data-section');
                const questionIndex = parseInt(target.getAttribute('data-question'));
                
                // Save answer
                state.answers[section][questionIndex] = value;
                
                // Update UI
                updateSelectedOption(target);
                checkSectionComplete(section);
                saveProgress();
            }

            function updateSelectedOption(selectedOption) {
                // Remove previous selection for this question
                const questionContainer = selectedOption.closest('.question-container');
                questionContainer.querySelectorAll('.scale-number').forEach(opt => {
                    opt.classList.remove('selected');
                    opt.setAttribute('aria-pressed', 'false');
                });
                
                // Mark as selected
                selectedOption.classList.add('selected');
                selectedOption.setAttribute('aria-pressed', 'true');
                selectedOption.focus();
            }

            function isSectionComplete(sectionId) {
                const sectionAnswers = state.answers[sectionId] || [];
                const sectionQuestions = config.sections.find(s => s.id === sectionId).questions;
                
                return sectionAnswers.length === sectionQuestions.length && 
                       sectionAnswers.every(answer => answer !== null && answer !== undefined);
            }

            function checkSectionComplete(sectionId) {
                const isComplete = isSectionComplete(sectionId);
                
                const completeIndicator = document.getElementById(`${sectionId}-complete`);
                if (isComplete) {
                    completeIndicator.classList.remove('hidden');
                } else {
                    completeIndicator.classList.add('hidden');
                }
                
                // Enable/disable next button
                const nextBtn = document.querySelector(`#section-${sectionId} #nextBtn`);
                if (nextBtn) {
                    nextBtn.disabled = !isComplete;
                }
            }

            function showSection(index) {
                // Validate index
                if (index < 0 || index >= config.sections.length) return;
                
                state.currentSection = index;
                
                // Hide all sections
                document.querySelectorAll('.form-section').forEach(section => {
                    section.classList.remove('active');
                });
                
                // Show current section
                const currentSection = document.getElementById(`section-${config.sections[index].id}`);
                if (currentSection) {
                    currentSection.classList.add('active');
                    
                    // Focus first interactive element
                    const firstInteractive = currentSection.querySelector('.scale-number, button');
                    if (firstInteractive) {
                        firstInteractive.focus();
                    }
                }
                
                // Update progress bar
                updateProgressBar();
            }

            function updateProgressBar() {
                const progress = (state.currentSection / config.sections.length) * 100;
                const progressBar = document.getElementById('progressBar');
                progressBar.style.width = `${progress}%`;
                progressBar.setAttribute('aria-valuenow', progress);
                progressBar.setAttribute('aria-label', `Progreso: ${Math.round(progress)}% completado`);
            }

            function nextSection() {
                if (state.currentSection < config.sections.length - 1) {
                    showSection(state.currentSection + 1);
                } else {
                    finishAssessment();
                }
            }

            function prevSection() {
                if (state.currentSection > 0) {
                    showSection(state.currentSection - 1);
                }
            }
            
            function restartQuestionnaire() {
                if (!confirm("¿Estás seguro de que deseas reiniciar el cuestionario? Se perderán todas tus respuestas.")) return;
                
                // Reset state
                state.currentSection = 0;
                state.answers = {};
                state.scores = {};
                state.totalScore = 0;
                
                // Destroy radar chart if exists
                if (state.radarChart) {
                    state.radarChart.destroy();
                    state.radarChart = null;
                }
                
                // Reinitialize answers
                config.sections.forEach(section => {
                    state.answers[section.id] = Array(section.questions.length).fill(null);
                });
                
                // Clear local storage
                localStorage.removeItem('diagnosticoProgress');
                
                // Restore initial view
                document.getElementById('form-sections-container').style.display = '';
                document.getElementById('results-section').style.display = 'none';
                
                // Re-render everything
                renderFormSections();
                showSection(state.currentSection);
                updateProgressBar();
            }

            function finishAssessment() {
                if (!confirm("¿Estás seguro de que deseas finalizar el diagnóstico?")) return;
                
                calculateScores();
                displayResults();
                sendEmailResults();
                
                // Hide form and show results
                document.getElementById('form-sections-container').style.display = 'none';
                document.getElementById('results-section').style.display = 'block';
                
                // Focus results header for accessibility
                document.querySelector('.results-header').setAttribute('tabindex', '-1');
                document.querySelector('.results-header').focus();
            }

            function calculateScores() {
                state.scores = {};
                state.totalScore = 0;
                
                config.sections.forEach(section => {
                    const sectionScore = (state.answers[section.id] || []).reduce((sum, val) => sum + (val || 0), 0);
                    state.scores[section.id] = sectionScore;
                    state.totalScore += sectionScore;
                });
            }

            function displayResults() {
                // Show business profile
                const profile = getBusinessProfile();
                document.getElementById('profile-title').textContent = profile.title;
                document.getElementById('profile-description').textContent = profile.description;
                
                // Create radar chart
                createRadarChart();
                
                // Show scores
                const tableBody = document.getElementById('results-table-body');
                tableBody.innerHTML = '';
                
                config.sections.forEach(section => {
                    const row = document.createElement('tr');
                    
                    const areaCell = document.createElement('td');
                    areaCell.textContent = section.title;
                    
                    const scoreCell = document.createElement('td');
                    scoreCell.innerHTML = `
                        <span>${state.scores[section.id]}/25</span>
                        <div class="score-bar" role="progressbar" aria-valuenow="${state.scores[section.id]}" aria-valuemin="0" aria-valuemax="25">
                            <div class="score-fill" style="width: ${(state.scores[section.id] / 25) * 100}%"></div>
                        </div>
                    `;
                    
                    const levelCell = document.createElement('td');
                    levelCell.textContent = getLevel(state.scores[section.id]);
                    
                    row.appendChild(areaCell);
                    row.appendChild(scoreCell);
                    row.appendChild(levelCell);
                    tableBody.appendChild(row);
                });
                
                // Show total
                const totalRow = document.createElement('tr');
                
                const totalLabelCell = document.createElement('td');
                totalLabelCell.textContent = 'Total';
                totalLabelCell.style.fontWeight = 'bold';
                
                const totalScoreCell = document.createElement('td');
                totalScoreCell.innerHTML = `
                    <strong>${state.totalScore}/125</strong>
                    <div class="score-bar" role="progressbar" aria-valuenow="${state.totalScore}" aria-valuemin="0" aria-valuemax="125">
                        <div class="score-fill" style="width: ${(state.totalScore / 125) * 100}%"></div>
                    </div>
                `;
                
                const totalLevelCell = document.createElement('td');
                totalLevelCell.textContent = getTotalLevel(state.totalScore);
                totalLevelCell.style.fontWeight = 'bold';
                
                totalRow.appendChild(totalLabelCell);
                totalRow.appendChild(totalScoreCell);
                totalRow.appendChild(totalLevelCell);
                tableBody.appendChild(totalRow);
                
                // Show recommendations
                displayRecommendations();
            }
            
            function createRadarChart() {
                const ctx = document.getElementById('radarChart').getContext('2d');
                
                // Destroy previous chart if exists
                if (state.radarChart) {
                    state.radarChart.destroy();
                }
                
                // Prepare chart data
                const labels = config.sections.map(section => section.title);
                const scores = config.sections.map(section => state.scores[section.id]);
                const maxScore = 25; // Max score per area
                
                // Chart configuration
                state.radarChart = new Chart(ctx, {
                    type: 'radar',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Puntuación por Área',
                            data: scores,
                            backgroundColor: 'rgba(42, 92, 170, 0.2)',
                            borderColor: 'rgba(42, 92, 170, 1)',
                            pointBackgroundColor: 'rgba(42, 92, 170, 1)',
                            pointBorderColor: '#fff',
                            pointHoverBackgroundColor: '#fff',
                            pointHoverBorderColor: 'rgba(42, 92, 170, 1)',
                            borderWidth: 2,
                            pointRadius: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            r: {
                                angleLines: {
                                    display: true,
                                    color: 'rgba(0, 0, 0, 0.1)'
                                },
                                suggestedMin: 0,
                                suggestedMax: maxScore,
                                ticks: {
                                    stepSize: 5,
                                    backdropColor: 'transparent',
                                    color: 'rgba(0, 0, 0, 0.7)'
                                },
                                pointLabels: {
                                    font: {
                                        size: 12,
                                        family: "'Open Sans', sans-serif"
                                    },
                                    color: 'rgba(0, 0, 0, 0.8)'
                                },
                                grid: {
                                    color: 'rgba(0, 0, 0, 0.1)'
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                position: 'top',
                                labels: {
                                    font: {
                                        family: "'Open Sans', sans-serif",
                                        size: 14
                                    },
                                    padding: 20
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return `${context.dataset.label}: ${context.raw}/25`;
                                    }
                                }
                            }
                        },
                        elements: {
                            line: {
                                tension: 0.1
                            }
                        }
                    }
                });
            }

            function displayRecommendations() {
                const container = document.getElementById('recommendations-container');
                container.innerHTML = '<h3>Recomendaciones por Área</h3>';
                
                config.sections.forEach(section => {
                    const sectionScore = state.scores[section.id];
                    const recommendations = getRecommendations(section.id, sectionScore);
                    
                    if (recommendations.length > 0) {
                        const block = document.createElement('div');
                        block.className = 'recommendation-block';
                        
                        const title = document.createElement('h4');
                        title.className = 'recommendation-title';
                        title.innerHTML = `<i class="fas ${section.icon}"></i> ${section.title}`;
                        
                        const list = document.createElement('ul');
                        list.className = 'recommendation-list';
                        
                        recommendations.forEach(rec => {
                            const item = document.createElement('li');
                            item.textContent = rec;
                            list.appendChild(item);
                        });
                        
                        block.appendChild(title);
                        block.appendChild(list);
                        container.appendChild(block);
                    }
                });
                
                // Add next steps
                const nextStepsBlock = document.createElement('div');
                nextStepsBlock.className = 'recommendation-block';
                
                const nextStepsTitle = document.createElement('h4');
                nextStepsTitle.className = 'recommendation-title';
                nextStepsTitle.innerHTML = '<i class="fas fa-road"></i> Próximos Pasos';
                
                const nextStepsList = document.createElement('ul');
                nextStepsList.className = 'recommendation-list';
                
                getNextSteps().forEach(step => {
                    const item = document.createElement('li');
                    item.textContent = step;
                    nextStepsList.appendChild(item);
                });
                
                nextStepsBlock.appendChild(nextStepsTitle);
                nextStepsBlock.appendChild(nextStepsList);
                container.appendChild(nextStepsBlock);
            }

            function getLevel(score) {
                if (score <= 5) return 'Inicial';
                if (score <= 10) return 'Básico';
                if (score <= 15) return 'Intermedio';
                if (score <= 20) return 'Avanzado';
                return 'Excelente';
            }

            function getTotalLevel(totalScore) {
                if (totalScore <= 25) return 'Inicial';
                if (totalScore <= 50) return 'Básico';
                if (totalScore <= 75) return 'Intermedio';
                if (totalScore <= 100) return 'Avanzado';
                return 'Excelente';
            }

            function getBusinessProfile() {
                // Calculate standard deviation to check balance between areas
                const avg = state.totalScore / config.sections.length;
                let variance = 0;
                for (const section in state.scores) {
                    variance += Math.pow(state.scores[section] - avg, 2);
                }
                const stdDev = Math.sqrt(variance / config.sections.length);
                
                // Determine profile based on score and balance
                if (state.totalScore <= 25) {
                    return {
                        title: "Empresa Inicial",
                        description: "Tu negocio está en etapas muy tempranas con sistemas y procesos limitados. Es importante sentar bases sólidas para el crecimiento futuro."
                    };
                } else if (state.totalScore <= 50) {
                    if (stdDev > 7) {
                        return {
                            title: "Empresa con Desequilibrios",
                            description: "Algunas áreas de tu negocio están más desarrolladas que otras, lo que puede crear cuellos de botella. Es importante equilibrar el desarrollo de todas las áreas funcionales."
                        };
                    } else {
                        return {
                            title: "Empresa Básica",
                            description: "Tu negocio tiene los fundamentos básicos establecidos, pero hay oportunidades significativas para mejorar en todas las áreas."
                        };
                    }
                } else if (state.totalScore <= 75) {
                    if (stdDev > 6) {
                        return {
                            title: "Empresa en Crecimiento Desorganizado",
                            description: "Tu negocio muestra signos de crecimiento, pero con falta de sistemas y procesos definidos que podrían limitar tu escalabilidad y rentabilidad a largo plazo."
                        };
                    } else {
                        return {
                            title: "Empresa en Crecimiento Organizado",
                            description: "Tu negocio está creciendo con relativo equilibrio entre áreas, pero aún hay espacio para mejorar procesos y sistemas para soportar un mayor crecimiento."
                        };
                    }
                } else if (state.totalScore <= 100) {
                    if (stdDev > 5) {
                        return {
                            title: "Empresa Avanzada con Áreas de Oportunidad",
                            description: "Tu negocio es bastante maduro en la mayoría de áreas, pero algunas podrían necesitar atención para alcanzar el mismo nivel de desarrollo."
                        };
                    } else {
                        return {
                            title: "Empresa Avanzada",
                            description: "Tienes un negocio bien establecido con sistemas y procesos sólidos en la mayoría de áreas. El enfoque ahora debe estar en optimización y excelencia."
                        };
                    }
                } else {
                    if (stdDev > 4) {
                        return {
                            title: "Empresa de Alto Desempeño",
                            description: "Tu negocio es un ejemplo de excelencia en la mayoría de áreas, con solo algunas oportunidades menores de mejora en áreas específicas."
                        };
                    } else {
                        return {
                            title: "Empresa de Clase Mundial",
                            description: "Felicidades, tienes un negocio excepcionalmente bien gestionado en todas las áreas clave, listo para escalar y competir a los más altos niveles."
                        };
                    }
                }
            }

            function getRecommendations(sectionId, score) {
                const sectionRecs = config.recommendations[sectionId];
                
                if (score <= 5) return sectionRecs['0-5'];
                if (score <= 10) return sectionRecs['6-10'];
                if (score <= 15) return sectionRecs['11-15'];
                if (score <= 20) return sectionRecs['16-20'];
                return sectionRecs['21-25'];
            }

            function getNextSteps() {
                const steps = [];
                
                // Identify weak areas
                let minScore = Infinity;
                let weakAreas = [];
                for (const section in state.scores) {
                    if (state.scores[section] < minScore) {
                        minScore = state.scores[section];
                        weakAreas = [config.sections.find(s => s.id === section).title];
                    } else if (state.scores[section] === minScore) {
                        weakAreas.push(config.sections.find(s => s.id === section).title);
                    }
                }
                
                if (weakAreas.length > 0) {
                    steps.push(`Prioriza mejorar en ${weakAreas.join(' y ')} (tus áreas más débiles)`);
                }
                
                // General steps based on level
                if (state.totalScore <= 50) {
                    steps.push("Enfócate en establecer sistemas y procesos básicos en todas las áreas");
                    steps.push("Considera asesoría externa para acelerar tu aprendizaje");
                } else if (state.totalScore <= 100) {
                    steps.push("Optimiza y estandariza tus procesos existentes");
                    steps.push("Implementa sistemas de medición y seguimiento de KPIs");
                } else {
                    steps.push("Busca la excelencia operativa y la innovación continua");
                    steps.push("Explora oportunidades de expansión y escalamiento");
                }
                
                steps.push("Programa una revisión estratégica trimestral para evaluar progreso");
                steps.push("Considera capacitación específica para tus áreas de oportunidad");
                
                return steps;
            }

            function generatePDF() {
                const spinner = document.getElementById('pdf-spinner');
                spinner.style.display = 'block';
                
                // Get chart image
                const radarChartCanvas = document.getElementById('radarChart');
                
                // Use setTimeout to simulate loading
                setTimeout(() => {
                    try {
                        const { jsPDF } = window.jspdf;
                        const doc = new jsPDF({
                            orientation: 'portrait',
                            unit: 'mm',
                            format: 'a4'
                        });
                        
                        // Add logo (placeholder - replace with actual logo)
                        doc.setFontSize(10);
                        doc.setTextColor(100);
                        doc.text('VESTRA Consultoría en Negocios', 20, 15);
                        doc.setDrawColor(42, 92, 170);
                        doc.setLineWidth(0.5);
                        doc.line(20, 17, 50, 17);
                        
                        // Title
                        doc.setFontSize(18);
                        doc.setTextColor(42, 92, 170);
                        doc.text('Resultados del Diagnóstico Empresarial', 105, 25, { align: 'center' });
                        
                        // Profile
                        doc.setFontSize(14);
                        doc.setTextColor(0);
                        doc.text(`Perfil identificado: ${document.getElementById('profile-title').textContent}`, 20, 40);
                        doc.setFontSize(12);
                        const profileDesc = doc.splitTextToSize(document.getElementById('profile-description').textContent, 170);
                        doc.text(profileDesc, 20, 48);
                        
                        // Add chart image
                        const chartImage = radarChartCanvas.toDataURL('image/png');
                        doc.addImage(chartImage, 'PNG', 20, 70, 170, 85);
                        
                        // Scores table
                        doc.autoTable({
                            startY: 160,
                            head: [['Área', 'Puntuación', 'Nivel']],
                            body: config.sections.map(section => [
                                section.title,
                                `${state.scores[section.id]}/25`,
                                getLevel(state.scores[section.id])
                            ]),
                            headStyles: {
                                fillColor: [42, 92, 170],
                                textColor: 255,
                                fontSize: 10
                            },
                            bodyStyles: {
                                fontSize: 9
                            },
                            alternateRowStyles: {
                                fillColor: [248, 249, 250]
                            },
                            margin: { top: 10 }
                        });
                        
                        // Recommendations
                        let yPos = doc.lastAutoTable.finalY + 10;
                        doc.setFontSize(14);
                        doc.setTextColor(42, 92, 170);
                        doc.text('Recomendaciones Clave', 20, yPos);
                        yPos += 8;
                        
                        config.sections.forEach(section => {
                            const recommendations = getRecommendations(section.id, state.scores[section.id]);
                            if (recommendations.length > 0) {
                                doc.setFontSize(12);
                                doc.setTextColor(42, 92, 170);
                                doc.text(`${section.title}:`, 20, yPos);
                                yPos += 6;
                                doc.setTextColor(0);
                                
                                recommendations.forEach(rec => {
                                    const lines = doc.splitTextToSize(`• ${rec}`, 170);
                                    doc.text(lines, 25, yPos);
                                    yPos += 6 * lines.length;
                                });
                                yPos += 4;
                            }
                        });
                        
                        // Next steps
                        doc.setFontSize(14);
                        doc.setTextColor(42, 92, 170);
                        doc.text('Próximos Pasos', 20, yPos + 8);
                        yPos += 12;
                        
                        getNextSteps().forEach(step => {
                            const lines = doc.splitTextToSize(`• ${step}`, 170);
                            doc.text(lines, 25, yPos);
                            yPos += 6 * lines.length;
                        });
                        
                        // Footer
                        doc.setFontSize(8);
                        doc.setTextColor(100);
                        doc.text('© Vestra Consultoría - Confidencial', 105, 285, { align: 'center' });
                        doc.text(`Generado el ${new Date().toLocaleDateString()}`, 190, 285, { align: 'right' });
                        
                        // Save PDF
                        doc.save(`diagnostico-empresarial-${new Date().toISOString().slice(0,10)}.pdf`);
                    } catch (error) {
                        console.error("Error al generar PDF:", error);
                        alert("Ocurrió un error al generar el PDF. Por favor intenta nuevamente.");
                    } finally {
                        spinner.style.display = 'none';
                    }
                }, 1000);
            }

            function sendEmailResults() {
                // Simulated email sending
                console.log("Enviando resultados por email...");
                console.log("Puntuaciones:", state.scores);
                console.log("Total:", state.totalScore);
                
                // In production, you would use fetch() to send to a backend
                /*
                fetch('/api/send-results', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        scores: state.scores,
                        totalScore: state.totalScore,
                        profile: getBusinessProfile()
                    })
                })
                .then(response => response.json())
                .then(data => {
                    console.log('Success:', data);
                })
                .catch((error) => {
                    console.error('Error:', error);
                });
                */
            }

            function saveProgress() {
                try {
                    localStorage.setItem('diagnosticoProgress', JSON.stringify({
                        currentSection: state.currentSection,
                        answers: state.answers
                    }));
                } catch (e) {
                    console.error("Error saving progress to localStorage:", e);
                }
            }

            function loadProgress() {
                try {
                    const savedData = localStorage.getItem('diagnosticoProgress');
                    if (savedData) {
                        const data = JSON.parse(savedData);
                        state.currentSection = data.currentSection || 0;
                        
                        // Merge saved answers with default structure
                        for (const sectionId in data.answers) {
                            if (state.answers[sectionId]) {
                                data.answers[sectionId].forEach((answer, index) => {
                                    if (answer !== null && index < state.answers[sectionId].length) {
                                        state.answers[sectionId][index] = answer;
                                    }
                                });
                            }
                        }
                    }
                } catch (e) {
                    console.error("Error loading progress from localStorage:", e);
                }
            }
        });
    </script>
</body>
</html>
